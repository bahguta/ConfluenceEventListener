##* @vtlvariable name="action" type="com.atlassian.confluence.user.actions.UserPopupAction" *#
##$helper.renderConfluenceMacro("{profile:user=%s|mode=hover|groups=$!{action.profileGroups}}", $action.username)

#requireResource("com.cis.confluence.plugins.confluencer-module:eventService-resources")
#requireResource("confluence.web.resources:aui-forms")
#requireResource("com.atlassian.auiplugin:aui-inline-dialog2")
#requireResource("com.atlassian.auiplugin:aui-toggle")

<html>
	<head>
        <meta name="decorator" content="atl.userprofile" />
        <meta content="system.profile.edit/confluencer-profile-section" name="system.profile.edit">
        $webResourceManager.requireResource("com.cis.confluence.plugins.confluencer-module:eventService-resources")
	</head>

    <body onload="script();">
        <section id="content" role="main">
            <div class="field-group form-buttons compact-form-buttons">
                <div class="aui-page-panel">
                    <div class="aui-page-panel-inner">
                        <div class="aui-page-panel-inner">
                            <h1>Confluencer</h1>
                        </div>
                        <div class="aui-page-panel-inner">
                            <h3>Cis Confluencer of the year</h3>
                            <div id="toggle-form">
                                <p>
                                    Pulsando el boton estas deacuerdo que vamos a recoger informacion de la cantidad de las spaces/paginas/comentarios que ha creado (en numeros),
                                    NO de la informacion del contenido de estas ultimas. La informacion va a ser usada unicamente
                                    para celebrar el evento de <b>"IECISA | Informatica El Corte Ingles" - Confluencer del a√±o !!!</b>
                                </p>
                                <aui-toggle id="toggle" data-aui-trigger value="$user.isParticipate()" label="Participaaaa !!!!!" >
                                    Paaaaaaarticipaaaa !!!!!
                                </aui-toggle>
                                <p>$user</p>
                                <script>
                                    AJS.$(document).ready(function(){
                                        AJS.$("#btnOK").click(function(){
                                        var trigger = document.querySelector('[data-aui-trigger]');
                                        var toggle = document.getElementById('toggle');
                                        var isChecked = toggle.checked;

                                            if (isChecked){
                                                alert("I WAS CLICKED   " + isChecked);
                                                $eventSeekerManager.userParticipate($user);
                                                alert("I WAS CLICKED   " + isChecked);
                                                window.location.href = href="/confluence/display/CON/Confluencer+Home";
                                            }
                                        });
                                    });
                                </script>
                            </div>
                           ## <script>
                             ##   function participaUser(){
                             ##       var trigger = document.querySelector('[data-aui-trigger]');
                             ##       var toggle = document.getElementById('toggle');
                             ##       var isChecked = toggle.isChecked();
                             ##       if (isChecked){
                             ##       Console.log("TRIGGER IS ENABLED !!!!" trigger.isEnabled());
                             ##           $user.setParticipate(isChecked);
                             ##       }
                             ##   }
                           ## </script>
                            <div class="aui-page-panel-inner">
                                <a id="btnOK" class="aui-button aui-button-primary aui-style">
                                    Voy a Participar
                                </a>
                                <a class="aui-button aui-button-link">Close</a>
                            </div>

                        </div>
                    </div>
                </div>
                <div>
                    ##<input type="checkbox" id="checkbox" name="checkbox" value="$participate">Participa</input>
                    <p>if participate</p>
                    #if ($participate) <p>$participate</p> #end
                    <p>if user.participate</p>
                    #if ($user.isParticipate()) <p> $user.isParticipate()</p> #end
                    <p>fin</p>
                </div>
            </div>
        </section>
    </body>
</html>
